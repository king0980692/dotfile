#!/bin/bash

# 腳本名稱: git_fzf_diff.sh
# 描述: 結合 fzf 與 delta，以互動方式瀏覽當前 git 差異檔案的內容。

# --- 設定變數 ---
# 您可以調整想要比較的範圍 (例如: HEAD, --cached, HEAD~1)
DIFF_RANGE="HEAD" # 預設為比較 工作區/暫存區 與 HEAD 之間的差異

# --- 核心指令 ---
# 1. git diff <DIFF_RANGE> --name-only：取得所有有差異的檔案清單。
# 2. fzf: 互動式選擇檔案。
#    --preview '...': 設定預覽指令。{} 會被替換為當前選中的檔案名。
#    delta: 用於美化 git diff 的輸出。
# 3. --bind 'ctrl-a:select-all+toggle-selection': 方便多選，但主要用於單選。
export DELTA_FEATURES=+side-by-side+line-numbers+decorations
git diff ${DIFF_RANGE} --name-only | fzf \
  --disabled \
  --reverse \
  --ansi \
  --multi \
  --cycle \
  --header "互動式檔案差異瀏覽 (esc 退出)" \
  --prompt "選擇要預覽的檔案: " \
  --preview-window 'right:70%' \
  --bind 'ctrl-f:page-down,ctrl-b:page-up' \
  --bind '?:toggle-preview' \
  --preview "git diff ${DIFF_RANGE} {} | delta"

# 提示: 如果您想比較工作區與暫存區的差異，請將 DIFF_RANGE 設為空字串，
#       並將預覽指令改為：--preview "git diff {} | delta"
#
# 提示: 如果您想比較暫存區與 HEAD 的差異，請將 DIFF_RANGE 設為 --cached
#       並將預覽指令改為：--preview "git diff --cached {} | delta"
